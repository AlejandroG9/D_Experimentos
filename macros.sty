\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{macros}[2025/08/18 Macros para manual de Diseño y Análisis de Experimentos]

% Paquetes requeridos
\RequirePackage{environ} % para \NewEnviron y \BODY
\RequirePackage{amsmath, amssymb, amsthm}
\RequirePackage{siunitx}
\RequirePackage{booktabs}
\RequirePackage{enumitem}
\RequirePackage{xcolor}
\RequirePackage{hyperref}
\RequirePackage{float}
\hypersetup{colorlinks=true, linkcolor=blue, urlcolor=blue, citecolor=blue}

% -------------------------------
% Toggle para mostrar/ocultar soluciones
% -------------------------------
\newif\ifshowsolutions
\showsolutionsfalse   % por defecto, NO mostrar
%\showsolutionstrue   % descomenta esta línea para mostrar soluciones

% -------------------------------
% Entorno de ejercicio
% -------------------------------
\newcounter{ejercicio}
\newenvironment{ejercicio}[1][]{
  \refstepcounter{ejercicio}
  \par\medskip
  \noindent\textbf{Ejercicio \theejercicio.} \textit{#1}\par
  \noindent\rule{\textwidth}{0.4pt}\par\medskip
}{\par\medskip \noindent\rule{\textwidth}{0.4pt}\par\medskip}

% -------------------------------
% Entorno 'clave' condicionado (versión robusta con environ)
% -------------------------------
% NOTA: No usar \newenvironment aquí. Esta versión evita el "Incomplete \iffalse".
\NewEnviron{clave}{%
  \ifshowsolutions
    \par\medskip
    \noindent\textbf{Clave rápida (solo profesor)}\par
    \begingroup\small
    \BODY
    \par\endgroup\medskip
  \fi
}

% -------------------------------
% Entorno de pasos
% -------------------------------
\newenvironment{pasos}{\begin{enumerate}[leftmargin=*, itemsep=2pt]}{\end{enumerate}}

% -------------------------------
% Comando para datos en bloque monoespaciado
% -------------------------------
\newcommand{\datos}[1]{%
  \par\medskip
  \noindent\textbf{Datos (muestra)}\par
  \begingroup\ttfamily\small #1 \par\endgroup
  \medskip
}

% -------------------------------
% Rúbrica reutilizable
% -------------------------------
\newcommand{\rubricaIC}{%
\begin{table}[H]
\centering
\begin{tabular}{p{0.28\textwidth} p{0.52\textwidth} c}
\toprule
\textbf{Criterio} & \textbf{Descripción} & \textbf{Puntos}\\
\midrule
Cálculo de la media muestral & Correcto cálculo de la media de los datos. & 10\\
Cálculo de la desviación estándar muestral & Obtención adecuada de la desviación estándar. & 10\\
Cálculo del error estándar (SE) & Determinación correcta de $SE = s/\sqrt{n}$. & 10\\
Selección del valor crítico & Elección correcta entre $Z$ o $t$ y justificación. & 15\\
Margen de error (ME) & Cálculo correcto del margen de error. & 10\\
Construcción del intervalo de confianza & Intervalo calculado correctamente. & 20\\
Interpretación de resultados & Explicación contextualizada en Ingeniería Industrial. & 15\\
Presentación y orden & Trabajo ordenado, claro y legible. & 10\\
\bottomrule
\end{tabular}
\caption{Rúbrica de evaluación (100 puntos).}
\end{table}
}



\newcommand{\rubricaProp}{%
\begin{table}[H]
\centering
\begin{tabular}{p{0.28\textwidth} p{0.52\textwidth} c}
\toprule
\textbf{Criterio} & \textbf{Descripción} & \textbf{Puntos}\\
\midrule
Cálculo de la proporción muestral $\hat{p}$
& Correcto cálculo de la proporción $x/n$. & 15\\
Cálculo del error estándar (SE)
& Determinación correcta de $SE = \sqrt{\hat{p}(1-\hat{p})/n}$. & 15\\
Selección del valor crítico
& Elección adecuada del valor $Z$ para el nivel de confianza. & 15\\
Cálculo del margen de error (ME)
& Cálculo correcto de $ME = Z \times SE$. & 15\\
Construcción del intervalo de confianza
& Intervalo calculado correctamente. & 20\\
Interpretación de resultados
& Explicación contextualizada en el problema de Ingeniería Industrial. & 15\\
Presentación y orden
& Trabajo ordenado, claro y legible. & 5\\
\bottomrule
\end{tabular}
\caption{Rúbrica de evaluación para intervalos de confianza de proporciones (100 puntos).}
\end{table}
}


\newcommand{\rubricaHipotesis}{%
\begin{table}[H]
\centering
\begin{tabular}{p{0.30\textwidth} p{0.50\textwidth} c}
\toprule
\textbf{Criterio} & \textbf{Descripción} & \textbf{Puntos}\\
\midrule
Planteamiento de hipótesis & Redacción correcta de $H_0$ y $H_1$ según el problema. & 15\\
Cálculo del error estándar (SE) & Determinación adecuada de $\sigma_{\bar{x}} = \sigma/\sqrt{n}$. & 15\\
Selección del valor crítico & Elección correcta de $Z_{\alpha/2}$ según el nivel de significancia. & 15\\
Construcción del intervalo de aceptación & Obtención correcta de $[\mu_0 \pm Z\cdot\sigma_{\bar{x}}]$. & 20\\
Decisión estadística & Identificación correcta de si se acepta o rechaza $H_0$. & 15\\
Interpretación en contexto & Explicación clara en términos del proceso de Ingeniería Industrial. & 15\\
Presentación y orden & Trabajo limpio, ordenado y legible. & 5\\
\bottomrule
\end{tabular}
\caption{Rúbrica de evaluación para pruebas de hipótesis en muestras grandes (100 puntos).}
\end{table}
}